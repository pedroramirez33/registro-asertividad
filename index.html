<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Asertividad</title>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 1.5rem;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      color: #ffffff;
      min-height: 100vh;
    }

    .hidden {
      display: none !important;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: #ffffff;
      text-align: center;
      font-weight: 600;
      letter-spacing: -0.5px;
    }

    /* --- NAVEGACI√ìN --- */
    .nav-container {
      max-width: 900px;
      margin: 0 auto 2rem;
      display: flex;
      gap: 1rem;
      background: linear-gradient(145deg, #1e1e1e, #252525);
      padding: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .nav-btn {
      flex: 1;
      padding: 1rem;
      font-size: 1rem;
      font-weight: 600;
      background: #2a2a2a;
      color: #aaaaaa;
      border: 2px solid #333333;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-btn:hover {
      border-color: #007aff;
      color: #ffffff;
    }

    .nav-btn.active {
      background: linear-gradient(135deg, #007aff 0%, #0051d5 100%);
      color: white;
      border-color: #007aff;
      box-shadow: 0 4px 15px rgba(0,122,255,0.3);
    }

    /* --- FORMULARIO --- */
    form {
      background: linear-gradient(145deg, #1e1e1e, #252525);
      padding: 1.5rem;
      border-radius: 16px;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.05);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    label {
      display: block;
      font-size: 0.85rem;
      margin-top: 1rem;
      color: #aaaaaa;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.4rem;
    }

    input, textarea, select {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      background: #0f0f0f;
      color: #ffffff;
      border: 2px solid #333333;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #007aff;
      box-shadow: 0 0 0 3px rgba(0,122,255,0.1);
    }

    select {
      cursor: pointer;
    }

    select option {
      background: #1a1a1a;
      color: #ffffff;
    }

    button[type="submit"] {
      margin-top: 1.5rem;
      width: 100%;
      padding: 1rem;
      font-size: 1.05rem;
      font-weight: 600;
      background: linear-gradient(135deg, #007aff 0%, #0051d5 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,122,255,0.3);
    }

    button[type="submit"]:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,122,255,0.4);
    }

    button[type="submit"]:active {
      transform: translateY(0);
    }

    /* --- GLOSARIO --- */
    .glosario-container {
      max-width: 800px;
      margin: 0 auto;
      background: linear-gradient(145deg, #1e1e1e, #252525);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.05);
    }

    .glosario-container h2 {
      color: #007aff;
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
    }

    .tecnica-item {
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .tecnica-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .tecnica-item strong {
      color: #ffd700;
      font-size: 1.1rem;
    }

    .tecnica-item p {
      margin: 0.5rem 0 0 0;
      line-height: 1.6;
      color: #cccccc;
    }

    /* --- CALENDARIO --- */
    .calendar-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      background: linear-gradient(145deg, #1e1e1e, #252525);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .calendar-header button {
      background: #2a2a2a;
      color: #ffffff;
      border: 2px solid #333333;
      padding: 0.6rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .calendar-header button:hover {
      border-color: #007aff;
      background: #333333;
    }

    .calendar-header h2 {
      margin: 0;
      font-size: 1.3rem;
      color: #ffffff;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
      margin-bottom: 2rem;
    }

    .calendar-day-header {
      text-align: center;
      padding: 0.8rem;
      font-weight: 600;
      color: #007aff;
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, #1e1e1e, #252525);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
      min-height: 60px;
    }

    .calendar-day:hover {
      transform: translateY(-2px);
      border-color: #007aff;
    }

    .calendar-day.other-month {
      opacity: 0.3;
    }

    .calendar-day.today {
      border-color: #ffd700;
    }

    .calendar-day.has-events {
      background: linear-gradient(145deg, #1a3a5a, #234060);
    }

    .calendar-day.has-events::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 6px;
      height: 6px;
      background: #007aff;
      border-radius: 50%;
    }

    .day-number {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .event-count {
      font-size: 0.7rem;
      color: #007aff;
      margin-top: 2px;
    }

    /* --- LISTA DE EVENTOS --- */
    .events-list {
      max-width: 600px;
      margin: 0 auto;
    }

    .selected-date-header {
      text-align: center;
      padding: 1rem;
      background: linear-gradient(145deg, #1e1e1e, #252525);
      border-radius: 12px;
      margin-bottom: 1.5rem;
      color: #007aff;
      font-weight: 600;
      font-size: 1.1rem;
      border: 1px solid rgba(255,255,255,0.05);
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: linear-gradient(145deg, #1e1e1e, #252525);
      margin-bottom: 1rem;
      padding: 1.2rem;
      border-radius: 12px;
      font-size: 0.95rem;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
      color: #ffffff;
      border: 1px solid rgba(255,255,255,0.05);
      transition: transform 0.2s ease;
    }

    li:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    li div {
      margin-top: 0.6rem;
      line-height: 1.6;
    }

    .fecha {
      font-weight: 600;
      margin-bottom: 0.8rem;
      color: #007aff;
      font-size: 1.05rem;
      padding-bottom: 0.6rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .field-label {
      color: #ffd700;
      font-weight: 600;
    }

    .field-value {
      color: #ffffff;
    }

    .no-events {
      text-align: center;
      padding: 2rem;
      color: #666666;
      font-style: italic;
    }

    .delete-btn {
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      background: linear-gradient(135deg, #ff3b30 0%, #d32f2f 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(255,59,48,0.3);
      width: 100%;
    }

    .delete-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255,59,48,0.4);
    }

    .delete-btn:active {
      transform: translateY(0);
    }

    @media (max-width: 600px) {
      .nav-container {
        flex-direction: column;
      }

      .calendar-day {
        min-height: 50px;
      }
      
      .day-number {
        font-size: 0.9rem;
      }
      
      .event-count {
        font-size: 0.6rem;
      }
    }
  </style>
</head>
<body>

  <h1>Registro personal: Asertividad</h1>

  <!-- NAVEGACI√ìN -->
  <div class="nav-container">
    <button class="nav-btn active" id="btnRegistro">üìù Generar registro</button>
    <button class="nav-btn" id="btnCalendario">üìÖ Ver registros</button>
    <button class="nav-btn" id="btnGlosario">üìñ T√©cnicas</button>
  </div>

  <!-- VISTA 1: FORMULARIO -->
  <div id="vistaFormulario">
    <form id="eventForm">
      <label>
        SITUACI√ìN
        <input type="text" id="situacion" required />
      </label>

      <label>
        T√âCNICA ASERTIVA
        <select id="tecnica" required>
          <option value="">Selecciona una t√©cnica...</option>
          <option value="Para ti - Para m√≠">Para ti - Para m√≠</option>
          <option value="Disco rayado">Disco rayado</option>
          <option value="Banco de niebla">Banco de niebla</option>
          <option value="Aserci√≥n negativa">Aserci√≥n negativa</option>
          <option value="Fraccionar los temas">Fraccionar los temas</option>
        </select>
      </label>

      <label>
        EMOCI√ìN
        <input type="text" id="emocion" required />
      </label>

      <label>
        CONSECUENCIAS
        <textarea id="consecuencias" rows="3" required></textarea>
      </label>

      <button type="submit">Guardar</button>
    </form>
  </div>

  <!-- VISTA 2: CALENDARIO -->
  <div id="vistaCalendario" class="hidden">
    <div class="calendar-container">
      <div class="calendar-header">
        <button id="prevMonth">‚Üê Anterior</button>
        <h2 id="currentMonth"></h2>
        <button id="nextMonth">Siguiente ‚Üí</button>
      </div>

      <div class="calendar-grid">
        <div class="calendar-day-header">L</div>
        <div class="calendar-day-header">M</div>
        <div class="calendar-day-header">X</div>
        <div class="calendar-day-header">J</div>
        <div class="calendar-day-header">V</div>
        <div class="calendar-day-header">S</div>
        <div class="calendar-day-header">D</div>
      </div>

      <div id="calendarDays" class="calendar-grid"></div>

      <div id="selectedDateEvents" class="events-list hidden">
        <div class="selected-date-header" id="selectedDateHeader"></div>
        <ul id="eventsList"></ul>
      </div>
    </div>
  </div>

  <!-- VISTA 3: GLOSARIO -->
  <div id="vistaGlosario" class="hidden">
    <div class="glosario-container">
      <h2>T√©cnicas Asertivas</h2>
      
      <div class="tecnica-item">
        <strong>Para ti - para m√≠:</strong>
        <p>Cuando alguien plantea una conducta que es opuesta o choca con nuestros valores o deseos podemos usar la f√≥rmula "para ti, ..., para m√≠, ...".</p>
      </div>

      <div class="tecnica-item">
        <strong>Disco rayado:</strong>
        <p>Consiste en repetir una y otra vez, de forma serena, nuestra opini√≥n, aunque no se den demasiadas explicaciones.</p>
      </div>

      <div class="tecnica-item">
        <strong>Banco de niebla:</strong>
        <p>Consiste en reconocer la raz√≥n que tiene la argumentaci√≥n de la otra persona, pero sin aceptar lo que nos propone.</p>
      </div>

      <div class="tecnica-item">
        <strong>Aserci√≥n negativa:</strong>
        <p>Consiste en admitir un error cometido cambiando autom√°ticamente a autoverbalizaciones positivas o a emitir una petici√≥n.</p>
      </div>

      <div class="tecnica-item">
        <strong>Interrogaci√≥n negativa:</strong>
        <p>Consiste en solicitar m√°s informaci√≥n bien para aprovechar esa informaci√≥n si es adecuada bien para agotarla si no es ajustada a la realidad.</p>
      </div>

      <div class="tecnica-item">
        <strong>Fraccionar los temas:</strong>
        <p>Consiste en dividir el mensaje de la otra persona y tratar cada parte por separado, remarcando la falta de relaci√≥n entre las partes.</p>
      </div>
    </div>
  </div>

<script>
let db;
let currentView = 'registro';
let currentDate = new Date();
let selectedDate = null;

// --- IndexedDB ---
const request = indexedDB.open("asertividadDB", 1);

request.onupgradeneeded = e => {
  db = e.target.result;
  db.createObjectStore("events", { keyPath: "id" });
};

request.onsuccess = e => {
  db = e.target.result;
  if (currentView === 'calendario') {
    renderCalendar();
  }
};

// --- Navegaci√≥n ---
document.getElementById('btnRegistro').addEventListener('click', () => {
  currentView = 'registro';
  document.getElementById('vistaFormulario').classList.remove('hidden');
  document.getElementById('vistaCalendario').classList.add('hidden');
  document.getElementById('vistaGlosario').classList.add('hidden');
  document.getElementById('btnRegistro').classList.add('active');
  document.getElementById('btnCalendario').classList.remove('active');
  document.getElementById('btnGlosario').classList.remove('active');
});

document.getElementById('btnCalendario').addEventListener('click', () => {
  currentView = 'calendario';
  document.getElementById('vistaFormulario').classList.add('hidden');
  document.getElementById('vistaCalendario').classList.remove('hidden');
  document.getElementById('vistaGlosario').classList.add('hidden');
  document.getElementById('btnRegistro').classList.remove('active');
  document.getElementById('btnCalendario').classList.add('active');
  document.getElementById('btnGlosario').classList.remove('active');
  renderCalendar();
});

document.getElementById('btnGlosario').addEventListener('click', () => {
  currentView = 'glosario';
  document.getElementById('vistaFormulario').classList.add('hidden');
  document.getElementById('vistaCalendario').classList.add('hidden');
  document.getElementById('vistaGlosario').classList.remove('hidden');
  document.getElementById('btnRegistro').classList.remove('active');
  document.getElementById('btnCalendario').classList.remove('active');
  document.getElementById('btnGlosario').classList.add('active');
});

// --- Guardar evento ---
document.getElementById("eventForm").addEventListener("submit", e => {
  e.preventDefault();

  const event = {
    id: crypto.randomUUID(),
    timestamp: Date.now(),
    situacion: situacion.value,
    tecnica: tecnica.value,
    emocion: emocion.value,
    consecuencias: consecuencias.value
  };

  const tx = db.transaction("events", "readwrite");
  tx.objectStore("events").add(event);

  tx.oncomplete = () => {
    e.target.reset();
    // Feedback visual sin alert
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = '‚úì Guardado';
    submitBtn.style.background = 'linear-gradient(135deg, #34c759 0%, #28a745 100%)';
    setTimeout(() => {
      submitBtn.textContent = originalText;
      submitBtn.style.background = 'linear-gradient(135deg, #007aff 0%, #0051d5 100%)';
    }, 2000);
  };
});

// --- Calendario ---
document.getElementById('prevMonth').addEventListener('click', () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar();
});

document.getElementById('nextMonth').addEventListener('click', () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar();
});

function renderCalendar() {
  if (!db) return;

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  // Actualizar header
  const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
  document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

  // Obtener eventos del mes
  const tx = db.transaction("events", "readonly");
  const store = tx.objectStore("events");

  store.getAll().onsuccess = e => {
    const allEvents = e.target.result;
    
    // Agrupar eventos por fecha
    const eventsByDate = {};
    allEvents.forEach(event => {
      const date = new Date(event.timestamp);
      const dateKey = `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
      if (!eventsByDate[dateKey]) {
        eventsByDate[dateKey] = [];
      }
      eventsByDate[dateKey].push(event);
    });

    // Renderizar d√≠as
    renderCalendarDays(year, month, eventsByDate);
  };
}

function renderCalendarDays(year, month, eventsByDate) {
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  const prevLastDay = new Date(year, month, 0);
  
  // Ajustar para que lunes sea el primer d√≠a (0)
  let firstDayOfWeek = firstDay.getDay() - 1;
  if (firstDayOfWeek === -1) firstDayOfWeek = 6;

  const daysContainer = document.getElementById('calendarDays');
  daysContainer.innerHTML = '';

  // D√≠as del mes anterior
  for (let i = firstDayOfWeek - 1; i >= 0; i--) {
    const day = prevLastDay.getDate() - i;
    const dayElement = createDayElement(day, month - 1, year, eventsByDate, true);
    daysContainer.appendChild(dayElement);
  }

  // D√≠as del mes actual
  for (let day = 1; day <= lastDay.getDate(); day++) {
    const dayElement = createDayElement(day, month, year, eventsByDate, false);
    daysContainer.appendChild(dayElement);
  }

  // D√≠as del siguiente mes
  const remainingDays = 42 - daysContainer.children.length; // 6 semanas
  for (let day = 1; day <= remainingDays; day++) {
    const dayElement = createDayElement(day, month + 1, year, eventsByDate, true);
    daysContainer.appendChild(dayElement);
  }
}

function createDayElement(day, month, year, eventsByDate, isOtherMonth) {
  const div = document.createElement('div');
  div.className = 'calendar-day';
  
  if (isOtherMonth) {
    div.classList.add('other-month');
  }

  // Verificar si es hoy
  const today = new Date();
  if (day === today.getDate() && 
      month === today.getMonth() && 
      year === today.getFullYear() &&
      !isOtherMonth) {
    div.classList.add('today');
  }

  const dateKey = `${year}-${month}-${day}`;
  const events = eventsByDate[dateKey] || [];

  if (events.length > 0) {
    div.classList.add('has-events');
  }

  div.innerHTML = `
    <div class="day-number">${day}</div>
    ${events.length > 0 ? `<div class="event-count">${events.length} evento${events.length > 1 ? 's' : ''}</div>` : ''}
  `;

  div.addEventListener('click', () => {
    showEventsForDate(day, month, year, events);
  });

  return div;
}

function showEventsForDate(day, month, year, events) {
  selectedDate = new Date(year, month, day);
  
  const monthNames = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 
                      'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
  const weekdays = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
  
  const dateStr = `${weekdays[selectedDate.getDay()]}, ${day} de ${monthNames[month]} de ${year}`;
  
  document.getElementById('selectedDateHeader').textContent = dateStr;
  document.getElementById('selectedDateEvents').classList.remove('hidden');
  
  const eventsList = document.getElementById('eventsList');
  eventsList.innerHTML = '';

  if (events.length === 0) {
    eventsList.innerHTML = '<div class="no-events">No hay registros para esta fecha</div>';
    return;
  }

  // Ordenar por hora (m√°s reciente primero)
  events.sort((a, b) => b.timestamp - a.timestamp);

events.forEach(ev => {
  const time = new Date(ev.timestamp).toLocaleTimeString('es-ES', { 
    hour: '2-digit', 
    minute: '2-digit' 
  });

  const li = document.createElement('li');
  li.innerHTML = `
    <div class="fecha">${time}</div>
    <div><span class="field-label">SITUACI√ìN:</span> <span class="field-value">${ev.situacion}</span></div>
    <div><span class="field-label">T√âCNICA ASERTIVA:</span> <span class="field-value">${ev.tecnica}</span></div>
    <div><span class="field-label">EMOCI√ìN:</span> <span class="field-value">${ev.emocion}</span></div>
    <div><span class="field-label">CONSECUENCIAS:</span> <span class="field-value">${ev.consecuencias}</span></div>
    <button class="delete-btn" data-id="${ev.id}">Eliminar este registro</button>
  `;
  eventsList.appendChild(li);
});

// Agregar funcionalidad de eliminar
document.querySelectorAll('.delete-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const id = this.getAttribute('data-id');
    eliminarEvento(id);
  });
});

function eliminarEvento(id) {
  if (!confirm("¬øSeguro que quieres eliminar este registro?")) return;

  const tx = db.transaction("events", "readwrite");
  const store = tx.objectStore("events");
  store.delete(id);

  tx.oncomplete = () => {
    alert("Registro eliminado");
    renderCalendar();
    if (selectedDate) {
      // volver a mostrar eventos del d√≠a seleccionado
      const year = selectedDate.getFullYear();
      const month = selectedDate.getMonth();
      const day = selectedDate.getDate();

      const tx2 = db.transaction("events", "readonly");
      const store2 = tx2.objectStore("events");
      store2.getAll().onsuccess = e => {
        const allEvents = e.target.result;
        const dateKey = `${year}-${month}-${day}`;
        const eventsForDay = allEvents.filter(ev => {
          const d = new Date(ev.timestamp);
          return `${d.getFullYear()}-${d.getMonth()}-${d.getDate()}` === dateKey;
        });
        showEventsForDate(day, month, year, eventsForDay);
      };
    }
  };
}
  
  // Scroll suave a los eventos
  document.getElementById('selectedDateEvents').scrollIntoView({ 
    behavior: 'smooth', 
    block: 'nearest' 
  });
}

</script>

</body>
</html>
